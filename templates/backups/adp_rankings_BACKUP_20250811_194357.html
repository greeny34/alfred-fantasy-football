<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADP Rankings - Fantasy Football</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .rankings-table {
            font-size: 0.9rem;
        }
        
        .position-QB { color: #dc3545; font-weight: bold; }
        .position-RB { color: #28a745; font-weight: bold; }
        .position-WR { color: #007bff; font-weight: bold; }
        .position-TE { color: #ffc107; font-weight: bold; }
        .position-K { color: #6c757d; font-weight: bold; }
        .position-DST { color: #6f42c1; font-weight: bold; }
        
        .adp-value {
            font-weight: bold;
            color: #333;
        }
        
        .source-count {
            font-size: 0.8rem;
            color: #666;
        }
        
        .filters {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .stats-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .ranking-row:hover {
            background-color: #f8f9fa;
        }
        
        .nav-pills .nav-link.active {
            background-color: #007bff;
        }
        
        .adp-range {
            font-size: 0.8rem;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <h2><i class="fas fa-chart-line"></i> ADP Rankings</h2>
                    <div>
                        <a href="/" class="btn btn-outline-primary btn-sm me-2">
                            <i class="fas fa-table"></i> Position Rankings
                        </a>
                        <a href="/draft" class="btn btn-outline-success btn-sm">
                            <i class="fas fa-chess-board"></i> Draft Board
                        </a>
                    </div>
                </div>
                <p class="text-muted">Average Draft Position from multiple sources (Fantrax, Sleeper, ESPN, MFL, NFFC)</p>
            </div>
        </div>
        
        <!-- Filters -->
        <div class="filters">
            <div class="row">
                <div class="col-md-3">
                    <label for="positionFilter" class="form-label">Position</label>
                    <select class="form-select" id="positionFilter">
                        <option value="">All Positions</option>
                        <option value="QB">QB</option>
                        <option value="RB">RB</option>
                        <option value="WR">WR</option>
                        <option value="TE">TE</option>
                        <option value="K">K</option>
                        <option value="DST">DST</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="teamFilter" class="form-label">Team</label>
                    <select class="form-select" id="teamFilter">
                        <option value="">All Teams</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="searchFilter" class="form-label">Search Player</label>
                    <input type="text" class="form-control" id="searchFilter" placeholder="Player name...">
                </div>
                <div class="col-md-3">
                    <label for="sourceFilter" class="form-label">Min Sources</label>
                    <select class="form-select" id="sourceFilter">
                        <option value="1">1+ Sources</option>
                        <option value="2">2+ Sources</option>
                        <option value="3" selected>3+ Sources</option>
                        <option value="4">4+ Sources</option>
                        <option value="5">All 5 Sources</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Source Toggle -->
        <div class="mb-3">
            <ul class="nav nav-pills" id="sourceTabs">
                <li class="nav-item">
                    <a class="nav-link active" id="consensus-tab" data-bs-toggle="pill" href="#consensus">
                        <i class="fas fa-calculator"></i> Consensus ADP
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="fantrax-tab" data-bs-toggle="pill" href="#fantrax">
                        Fantrax
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="sleeper-tab" data-bs-toggle="pill" href="#sleeper">
                        Sleeper
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="espn-tab" data-bs-toggle="pill" href="#espn">
                        ESPN
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="mfl-tab" data-bs-toggle="pill" href="#mfl">
                        MFL
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="nffc-tab" data-bs-toggle="pill" href="#nffc">
                        NFFC
                    </a>
                </li>
            </ul>
        </div>
        
        <!-- Rankings Table -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover rankings-table">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Rank</th>
                                        <th>Player</th>
                                        <th>Pos</th>
                                        <th>Team</th>
                                        <th>ADP</th>
                                        <th>Range</th>
                                        <th>Sources</th>
                                        <th>Individual ADPs</th>
                                    </tr>
                                </thead>
                                <tbody id="rankingsTable">
                                    <!-- Rankings will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="text-center my-5" style="display: none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <div class="mt-2">Loading ADP data...</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let allRankings = [];
        let currentView = 'consensus';
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadADPData();
            setupEventListeners();
        });
        
        function setupEventListeners() {
            // Filter events
            document.getElementById('positionFilter').addEventListener('change', filterRankings);
            document.getElementById('teamFilter').addEventListener('change', filterRankings);
            document.getElementById('searchFilter').addEventListener('input', filterRankings);
            document.getElementById('sourceFilter').addEventListener('change', filterRankings);
            
            // Tab events
            document.querySelectorAll('#sourceTabs .nav-link').forEach(tab => {
                tab.addEventListener('click', function(e) {
                    e.preventDefault();
                    currentView = this.getAttribute('href').substring(1);
                    loadADPData();
                });
            });
        }
        
        function loadADPData() {
            showLoading(true);
            
            const endpoint = currentView === 'consensus' 
                ? '/api/adp/consensus'
                : `/api/adp/source/${currentView}`;
            
            fetch(endpoint)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        allRankings = data.rankings;
                        populateTeamFilter(allRankings);
                        filterRankings();
                    } else {
                        showError('Failed to load ADP data');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showError('Error loading ADP data');
                })
                .finally(() => {
                    showLoading(false);
                });
        }
        
        function populateTeamFilter(rankings) {
            const teamSelect = document.getElementById('teamFilter');
            const teams = [...new Set(rankings.map(r => r.team))].sort();
            
            teamSelect.innerHTML = '<option value="">All Teams</option>';
            teams.forEach(team => {
                teamSelect.innerHTML += `<option value="${team}">${team}</option>`;
            });
        }
        
        function filterRankings() {
            const position = document.getElementById('positionFilter').value;
            const team = document.getElementById('teamFilter').value;
            const search = document.getElementById('searchFilter').value.toLowerCase();
            const minSources = parseInt(document.getElementById('sourceFilter').value);
            
            let filtered = allRankings.filter(ranking => {
                if (position && ranking.position !== position) return false;
                if (team && ranking.team !== team) return false;
                if (search && !ranking.name.toLowerCase().includes(search)) return false;
                if (currentView === 'consensus' && ranking.source_count < minSources) return false;
                return true;
            });
            
            renderRankings(filtered);
        }
        
        function renderRankings(rankings) {
            const tbody = document.getElementById('rankingsTable');
            let html = '';
            
            rankings.forEach((ranking, index) => {
                html += `
                    <tr class="ranking-row">
                        <td><strong>${index + 1}</strong></td>
                        <td><strong>${ranking.name}</strong></td>
                        <td><span class="position-${ranking.position}">${ranking.position}</span></td>
                        <td>${ranking.team}</td>
                        <td class="adp-value">${formatADP(ranking.adp)}</td>
                        <td class="adp-range">${formatRange(ranking)}</td>
                        <td class="source-count">${formatSources(ranking)}</td>
                        <td class="individual-adps">${formatIndividualADPs(ranking)}</td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }
        
        function formatADP(adp) {
            return typeof adp === 'number' ? adp.toFixed(1) : adp;
        }
        
        function formatRange(ranking) {
            if (currentView === 'consensus' && ranking.min_adp && ranking.max_adp) {
                return `${ranking.min_adp.toFixed(1)} - ${ranking.max_adp.toFixed(1)}`;
            }
            return '-';
        }
        
        function formatSources(ranking) {
            if (currentView === 'consensus') {
                return `${ranking.source_count}/5`;
            }
            return '1/1';
        }
        
        function formatIndividualADPs(ranking) {
            if (currentView === 'consensus' && ranking.individual_adps) {
                return ranking.individual_adps.map(adp => 
                    `<span class="badge bg-secondary me-1">${adp.source}: ${adp.value.toFixed(1)}</span>`
                ).join('');
            }
            return `<span class="badge bg-primary">${currentView}: ${formatADP(ranking.adp)}</span>`;
        }
        
        function showLoading(show) {
            document.getElementById('loadingSpinner').style.display = show ? 'block' : 'none';
        }
        
        function showError(message) {
            const tbody = document.getElementById('rankingsTable');
            tbody.innerHTML = `
                <tr>
                    <td colspan="8" class="text-center text-danger">
                        <i class="fas fa-exclamation-triangle"></i> ${message}
                    </td>
                </tr>
            `;
        }
    </script>
</body>
</html>